---
layout: post
title: "JPA ë©´ì ‘ ì§ˆë¬¸ ëª¨ìŒ"
author: "Poogle"
categories: [BackEnd]
sitemap:
  changefreq: daily
  priority: 1.0
comments: true
tag: [JPA]

---

> ì°¸ê³ 

> [ë°±ì—”ë“œê°œë°œ spring ìŠ¤í”„ë§ ê¸°ìˆ ë©´ì ‘)IT ì„œë¹„ìŠ¤ íƒ‘í‹°ì–´ íšŒì‚¬ ì‹ ì…ê°œë°œì spring ë‹¨ê³¨ ì§ˆë¬¸](https://www.youtube.com/watch?v=1V4BlCFhGV4)

> [Backend-Interview-Question](https://github.com/ksundong/backend-interview-question)

> [[ê¸°ìˆ  ë©´ì ‘ ì¤€ë¹„ - 2ì¼ì°¨] Spring Framework && Database](https://imbf.github.io/interview/2020/12/10/NAVER-Interview-Preparation-2.html)

> [[ì‹¤ë¬´ ë©´ì ‘ ì¤€ë¹„ - 8] Spring Framework](https://imbf.github.io/interview/2021/03/06/NAVER-Practical-Interview-Preparation-8.html)

---
<br>

# ğŸ“Œ ORM
## â“ ORM; Object-Relational-Mapping ê°ì²´-ê´€ê³„-ë§¤í•‘ì´ë€?
![image](https://user-images.githubusercontent.com/58318786/232983018-f174ec25-42b6-4c2e-88b8-10c2ab361e66.png)

* ORM í”„ë ˆì„ì›Œí¬ëŠ” ìë°” ê°ì²´ì™€ ê´€ê³„í˜• DBë¥¼ ë§¤í•‘í•´ ê°ì²´ê°€ DB í…Œì´ë¸”ì´ ë˜ë„ë¡ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤.
* ORMì„ ì‚¬ìš©í•˜ë©´, SQLì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ì§ê´€ì ì¸ ë©”ì†Œë“œë¡œ ë°ì´í„°ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. (ê°œë°œìì˜ ìƒì‚°ì„± í–¥ìƒ)
* ì¢…ë¥˜ë¡œëŠ” Hibernate, EclipseLink, DataNucleus ë“±ì´ ìˆìŠµë‹ˆë‹¤.
* ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œëŠ” spring-boot-starter-data-jpaë¡œ íŒ¨í‚¤ì§€ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ë©°, ì´ëŠ” Hibernate í”„ë ˆì„ì›Œí¬ë¥¼ í™œìš©í•œë‹¤.
* JPAëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ JDBC ì‚¬ì´ì—ì„œ ë™ì‘í•˜ë©°, ê°œë°œìê°€ JPAë¥¼ í™œìš©í–ˆì„ ë•Œ JDBC APIë¥¼ í†µí•´ SQLì„ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ í˜¸ì¶œí•˜ëŠ” ì „ê°œê°€ ì´ë£¨ì–´ì§„ë‹¤.
* ì¦‰, ê°œë°œìëŠ” JPAì˜ í™œìš©ë²•ë§Œ ìµíˆë©´ DB ì¿¼ë¦¬ êµ¬í˜„ì—†ì´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

## â“ Persistence Context ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€?
* ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

## â“ JPA ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì´ì (5ê°€ì§€)ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì“°ëŠ” ì´ìœ ëŠ” 1ì°¨ ìºì‹œ, ë™ì¼ì„± ë³´ì¥, ì“°ê¸° ì§€ì—°, ë³€ê²½ê°ì§€(Dirty checking), ì§€ì—°ë¡œë”©ì´ ìˆìŠµë‹ˆë‹¤.

### 1ì°¨ ìºì‹œ
* ì¡°íšŒê°€ ê°€ëŠ¥í•˜ë©° 1ì°¨ ìºì‹œì— ì—†ìœ¼ë©´ DBì—ì„œ ì¡°íšŒí•˜ì—¬ 1ì°¨ ìºì‹œì— ì˜¬ë ¤ ë†“ìŠµë‹ˆë‹¤.

### ë™ì¼ì„± ë³´ì¥
* ë™ì¼ì„± ë¹„êµê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.(==)

### ì“°ê¸° ì§€ì—°
* íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°ì´ ê°€ëŠ¥í•˜ë©° íŠ¸ëœì­ì…˜ ì»¤ë°‹í•˜ê¸° ì „ê¹Œì§€ SQLì„ ë°”ë¡œ ë³´ë‚´ì§€ ì•Šê³  ëª¨ì•„ì„œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë³€ê²½ ê°ì§€(Dirty checking)
* Dirty: ìƒíƒœì˜ ë³€í™”ê°€ ìƒê¹€ / Checking: ê²€ì‚¬
* íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ Entityì˜ ë³€ê²½ì´ ì¼ì–´ë‚¬ì„ ë•Œ ë³€ê²½í•œ ë‚´ìš©ì„ ìë™ìœ¼ë¡œ DBì— ë°˜ì˜í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ëŠ” Entityë§Œ Checkingì˜ ëŒ€ìƒì´ ë©ë‹ˆë‹¤. ì¤€ì˜ì†, ë¹„ì˜ì† EntityëŠ” ë°˜ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* ìŠ¤ëƒ…ìƒ·ì„ 1ì°¨ ìºì‹œì— ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ ì°ìŠµë‹ˆë‹¤. commit ë˜ëŠ” ì‹œì ì— Entityì™€ ìŠ¤ëƒ…ìƒ·ê³¼ ë¹„êµí•˜ì—¬ update SQLì„ ìƒì„±í•©ë‹ˆë‹¤.
* ex) ì£¼ë¬¸ ì·¨ì†Œ ë©”ì†Œë“œë¥¼ êµ¬í˜„í•  ë•Œ ë©”ì†Œë“œ ë‚´ì— update ë¡œì§ì´ ì—†ì–´ë„ ë°ì´í„°ë² ì´ìŠ¤ì— updateê°€ ë°˜ì˜
  * ì—”í‹°í‹°ì—ì„œ ë³€ê²½ì´ ì¼ì–´ë‚œ ê±¸ ê°ì§€í•œ ë’¤ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜(ë³€ê²½ì€ ìµœì´ˆ ì¡°íšŒ ìƒíƒœ ê¸°ì¤€)
* `@DynamicUpdate`ë¥¼ ì‚¬ìš©í•´ì„œ SQLì—ì„œëŠ” ë³€ê²½ëœ ì—”í‹°í‹°ì˜ ëª¨ë“  í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šê³  ë³€ê²½ í•„ë“œë§Œ ë°˜ì˜ì‹œí‚¤ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì§€ì—° ë¡œë”©
* ì—”í‹°í‹°ì—ì„œ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ê·¸ ë•Œ SQLì„ ë‚ ë ¤ í•´ë‹¹ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

#### cf) ì°¸ê³ : ì¦‰ì‹œë¡œë”©(Eager Loading) / ì§€ì—°ë¡œë”©(Lazy Loading)
* ì¦‰ì‹œë¡œë”©
  * íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ì—°ê´€ëœ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ê°™ì´ ë¡œë”©, ì¦‰ì‹œ ë¡œë”©ì´ë¼ê³  í•©ë‹ˆë‹¤. 
  * ì¦‰ì‹œ ë¡œë”©ì€ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ëª¨ë‘ ê°€ì ¸ì˜¨ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, ì‹¤ë¬´ì—ì„œ ì—”í‹°í‹°ê°„ì˜ ê´€ê³„ê°€ ë³µì¡í•´ì§ˆìˆ˜ë¡ ì¡°ì¸ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ë¥¼ í”¼í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.
  * JPAì—ì„œ ì—°ê´€ê´€ê³„ì˜ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ì˜¬ ê²ƒì¸ê°€ë¥¼ fetch(íŒ¨ì¹˜)ë¼ê³  í•˜ëŠ”ë°, ì—°ê´€ê´€ê³„ì˜ ì–´ë…¸í…Œì´ì…˜ ì†ì„±ìœ¼ë¡œ fetchëª¨ë“œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  * EagerLoading(ì¦‰ì‹œ ë¡œë”©)ì€ ë¶ˆí•„ìš”í•œ ì¡°ì¸ê¹Œì§€ í¬í•¨í•´ì„œ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°ê°€ ë§ê¸° ë•Œë¬¸ì— LazyLoading(ì§€ì—° ë¡œë”©)ì˜ ì‚¬ìš©ì„ ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.
* ì§€ì—°ë¡œë”©
  * ê°€ëŠ¥í•œ ê°ì²´ì˜ ì´ˆê¸°í™”ë¥¼ ì§€ì—°ì‹œì¼œ ë¡œë”©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
  * ì¦‰, ì‹¤ì œ ê°ì²´ ëŒ€ì‹  í”„ë¡ì‹œ ê°ì²´ë¥¼ ë¡œë”©í•´ë‘ê³  í•´ë‹¹ ê°ì²´ë¥¼ ì‹¤ì œ ì‚¬ìš©í•  ë•Œë§Œ(ex. getter ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ë•Œ) ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í†µí•´ ì‹¤ì²´ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¡œë”©ì…ë‹ˆë‹¤. 
  * @XToOne(OneToOne, ManyToOne) ê´€ê³„ëŠ” ê¸°ë³¸ì´ EagerLoading(ì¦‰ì‹œ ë¡œë”©)ì´ë¯€ë¡œ ì§ì ‘ ì§€ì—°ë¡œë”©(fetch = FetchType.LAZY)ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.


## â“ JPAì˜ íŠ¹ì§•ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.
* ê°ì²´ ì¤‘ì‹¬ ê°œë°œ ê°€ëŠ¥
* ìƒì‚°ì„± ì¦ê°€
  * ì¿¼ë¦¬ë¥¼ ì¼ì¼íˆ ì‘ì„±í•  í•„ìš”ê°€ ì—†ì–´ ì½”ë“œ ì‘ì—…ëŸ‰ì´ ì¤„ì–´ë“ ë‹¤.
* ê°€ë…ì„±ì´ ë›°ì–´ë‚˜ë‹¤.
* ìˆ˜ì •ì´ ê°„í¸í•´ ìœ ì§€ë³´ìˆ˜, ë¦¬íŒ©í† ë§ì— ìš©ì´í•˜ë‹¤.
  * ì¿¼ë¦¬ ìˆ˜ì •ì´ í•„ìš”í•  ë•Œ, ì´ë¥¼ ë‹´ì•„ì•¼ í•  DTO í•„ë“œë„ ëª¨ë‘ ë³€ê²½í•´ì•¼ í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ì§€ë§Œ JPAì—ì„œëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ ì •ë³´ë§Œ ë³€ê²½í•˜ë©´ ë˜ë¯€ë¡œ ìœ ì§€ë³´ìˆ˜ì— ìš©ì´í•˜ë‹¤.

## â“ JPAë¥¼ ì“´ë‹¤ë©´ ê·¸ ì´ìœ ì— ëŒ€í•´ì„œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
* JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ê°ì²´ì§€í–¥ í”„ë ˆì„ì›Œí¬ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. JPAë¥¼ ì‚¬ìš©í•˜ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ RDBMSì— ì˜ì¡´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìë°” ì½”ë“œë¡œ í‘œí˜„ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê·¸ë¡œ ì¸í•´ì„œ ìƒì‚°ì„±ì´ ë†’ì•„ì§„ë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ì´ëŠ” JPAì— ìµìˆ™í•˜ë‹¤ëŠ” ê²ƒì„ ì „ì œë¡œ í•©ë‹ˆë‹¤.)
* ë˜, JPAëŠ” JPQLë¡œ SQLì„ ì¶”ìƒí™”í•˜ê¸° ë•Œë¬¸ì— RDBMS Vendorì— ê´€ê³„ì—†ì´ ë™ì¼í•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì„œ ê°™ì€ ë™ì‘ì„ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ë„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” database dialectë¥¼ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ê°€ì§€ëŠ” ì¥ì ì…ë‹ˆë‹¤.

## â“ JPAì˜ í•œê³„ì ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”. (Mybatisì™€ ì—°ê´€)
* ë§¤í•‘ ì„¤ê³„ë¥¼ ì˜ëª»í–ˆì„ ë•Œ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
  * JPAëŠ” ë³µì¡í•œ ì¿¼ë¦¬ë³´ë‹¤ëŠ” ì‹¤ì‹œê°„ ì¿¼ë¦¬ì— ìµœì í™”ë˜ì–´ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ í†µê³„ ì²˜ë¦¬ì™€ ê°™ì€ ë³µì¡í•œ ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš°ì—ëŠ” ê¸°ì¡´ì˜ Mybatisì™€ ê°™ì€ Mapper ë°©ì‹ì´ ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆë‹¤.
* Springì—ì„œëŠ” JPAì™€ Mybatisë¥¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ìƒí™©ì— ë§ëŠ” ë°©ì‹ì„ íƒí•˜ì—¬ ê°œë°œí•˜ë©´ ëœë‹¤.
* ë™ì  ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ê°€ë…ì„±ì´ ë–¨ì–´ì ¸ ìœ ì§€ë³´ìˆ˜ ì‹œ ì–´ë ¤ì›€ì´ ìˆë‹¤.

## â“ JPA Propagation ì „íŒŒë‹¨ê³„ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.
* JPA Propagationì€ íŠ¸ëœì­ì…˜ ë™ì‘ ë„ì¤‘ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì„ í˜¸ì¶œ(ì‹¤í–‰)í•˜ëŠ” ìƒí™©ì— ì„ íƒí•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì…ë‹ˆë‹¤.
* @Transactionalì˜ propagation ì†ì„±ì„ í†µí•´ í”¼í˜¸ì¶œ íŠ¸ëœì­ì…˜ì˜ ì…ì¥ì—ì„œëŠ” í˜¸ì¶œí•œ ìª½ì˜ íŠ¸ëœì­ì…˜ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆê³ , ìƒˆë¡­ê²Œ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
* REQUIRED(ë””í´íŠ¸): ë¶€ëª¨ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰í•˜ë©° ë¶€ëª¨ íŠ¸ëœì­ì…˜ì´ ì—†ì„ ê²½ìš° ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.

## â“ N + 1 ë¬¸ì œëŠ” ë¬´ì—‡ì´ê³  ì´ê²ƒì´ ë°œìƒí•˜ëŠ” ì´ìœ ì™€ ì´ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.
* N + 1 ì¿¼ë¦¬ ë¬¸ì œëŠ” ì¦‰ì‹œ ë¡œë”©ê³¼ ì§€ì—° ë¡œë”© ì „ëµ ê°ê°ì˜ ìƒí™©ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
* í•˜ìœ„ ì—”í‹°í‹°ë“¤ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° í•œ ì¿¼ë¦¬ì—ì„œ ëª¨ë‘ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹Œ, í•„ìš”í•œ ê³³ì—ì„œ ê°ê° ì¿¼ë¦¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°ë¥¼ ì´ë¦…ë‹ˆë‹¤.
* ì¦‰ì‹œ ë¡œë”©ì—ì„œ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” JPQLì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì „ì²´ ì¡°íšŒë¥¼ í–ˆì„ ë•Œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ì¡°íšŒí•œ ë‹¤ìŒ ì¦‰ì‹œë¡œë”© ì „ëµì´ ë™ì‘í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
* ì§€ì—° ë¡œë”©ì—ì„œ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ì§€ì—°ë¡œë”© ì „ëµì„ ì‚¬ìš©í•œ í•˜ìœ„ ì—”í‹°í‹°ë¥¼ ë¡œë“œí•  ë•Œ, JPAì—ì„œ í”„ë¡ì‹œ ì—”í‹°í‹°ë¥¼ unproxy í•  ë•Œ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•œ ì¶”ê°€ì ì¸ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì–´ ë°œìƒí•©ë‹ˆë‹¤.

### í•´ê²° ë°©ë²•
* Fetch Joinì´ë¼ê³  ë¶ˆë¦¬ëŠ” JPQLì˜ join fetchë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
  * N+1 ìì²´ê°€ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” í•œìª½ í…Œì´ë¸”ë§Œ ì¡°íšŒí•˜ê³  ì—°ê²°ëœ ë‹¤ë¥¸ í…Œì´ë¸”ê¹Œì§€ ë”°ë¡œ ì¡°íšŒë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 
  * ë¯¸ë¦¬ ë‘ í…Œì´ë¸”ì„ JOIN í•˜ì—¬ í•œ ë²ˆì— ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ë©´ ì• ì´ˆì— N+1 ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì´ëŸ°ë°©ì‹ì„ fetchJoin ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. 
  * fetchJoin : ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ í•œ ë²ˆì— ê°™ì´ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. fetchJoinì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ëŠ” í”„ë¡ì‹œê°€ ì•„ë‹Œ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê²Œ ë˜ë¯€ë¡œ ì—°ê´€ê´€ê³„ ê°ì²´ê¹Œì§€ í•œë²ˆì˜ ì¿¼ë¦¬ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  * âš  ï¸ë‹¨ì 
    * ì¿¼ë¦¬ í•œë²ˆì— ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— JPAê°€ ì œê³µí•˜ëŠ” Paging API ì‚¬ìš© ë¶ˆê°€ëŠ¥(Pageable ì‚¬ìš© ë¶ˆê°€)
    * 1:N ê´€ê³„ê°€ ë‘ ê°œ ì´ìƒì¸ ê²½ìš° ì‚¬ìš© ë¶ˆê°€ 
    * íŒ¨ì¹˜ ì¡°ì¸ ëŒ€ìƒì—ê²Œ ë³„ì¹­(as) ë¶€ì—¬ ë¶ˆê°€ëŠ¥ 
    * ë²ˆê±°ë¡­ê²Œ ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•´ì•¼ í•¨
* @EntityGraphë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
  * @EntityGraph ì˜ attributePathsëŠ” ê°™ì´ ì¡°íšŒí•  ì—°ê´€ ì—”í‹°í‹°ëª…ì„ ì ìœ¼ë©´ ë©ë‹ˆë‹¤. ,(ì½¤ë§ˆ)ë¥¼ í†µí•´ ì—¬ëŸ¬ ê°œë¥¼ ì¤„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. 
  * Fetch joinê³¼ ë™ì¼í•˜ê²Œ JPQLì„ ì‚¬ìš©í•´ Queryë¬¸ì„ ì‘ì„±í•˜ê³  í•„ìš”í•œ ì—°ê´€ê´€ê³„ë¥¼ EntityGraphì— ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. 
  * ex.
  ```java
  @EntityGraph(attributePaths = {"pets"})
  @Query("select DISTINCT o from Owner o")
  ```
  * EntityGraphëŠ” ë¯¸ë¦¬ ë°ì´í„°ë¥¼ ì¡°ì¸(outerJoin)í•´ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
* @Fetch(FetchMode.SUBSELECT)ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
* @BatchSizeë¥¼ ì‚¬ìš©í•´ ì¡°ì ˆí•˜ê±°ë‚˜ ì „ì—­ì ì¸ batch-sizeë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²•


## â“ Fetch Join, EntityGraphë¥¼ ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•  ì ì€ ë¬´ì—‡ì¸ê°€ìš”?

FetchJoinê³¼ EntityGraphëŠ” ê³µí†µì ìœ¼ë¡œ ì¹´í…Œì‹œì•ˆ ê³±(Cartesian Product)ì´ ë°œìƒ í•˜ì—¬ ì¤‘ë³µì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

â€» ì¹´í…Œì‹œì•ˆ ê³± : ë‘ í…Œì´ë¸” ì‚¬ì´ì— ìœ íš¨ join ì¡°ê±´ì„ ì ì§€ ì•Šì•˜ì„ ë•Œ í•´ë‹¹ í…Œì´ë¸”ì— ëŒ€í•œ ëª¨ë“  ë°ì´í„°ë¥¼ ì „ë¶€ ê²°í•©í•˜ì—¬ í…Œì´ë¸”ì— ì¡´ì¬í•˜ëŠ” í–‰ ê°¯ìˆ˜ë¥¼ ê³±í•œë§Œí¼ì˜ ê²°ê³¼ ê°’ì´ ë°˜í™˜ë˜ëŠ” ê²ƒ

ì¹´í…Œì‹œì•ˆ ê³±(Cartesian Product)ì„ ì¼ì´í‚¤ëŠ” Cross Join
ì¹´í…Œì‹œì•ˆ ê³±ì´ ì¼ì–´ë‚˜ëŠ” Cross Joinì€ JPA ê¸°ëŠ¥ ë•Œë¬¸ì´ ì•„ë‹ˆë¼, ì¿¼ë¦¬ì˜ í‘œí˜„ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œì´ë‹¤.

Cross Joinì´ ì¼ì–´ë‚˜ëŠ” ì¡°ê±´
Join ëª…ë ¹ì„ í–ˆì„ ë•Œ ëª…í™•í•œ Join ê·œì¹™ì´ ì£¼ì–´ì§€ì§€ ì•Šì•˜ì„ ë•Œ,
join ì´í›„ on ì ˆì´ ì—†ì„ ë•Œ, dbëŠ” ë‘ í…Œì´ë¸”ì˜ ê²°í•©í•œ ê²°ê³¼ëŠ” ë‚´ë³´ë‚´ì•¼ê² ê³ , ì¡°ê±´ì´ ì—†ìœ¼ë‹ˆ M * Nìœ¼ë¡œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ëŠ” ê²ƒì´ë‹¤.

JPAëŠ” ì‚¬ìš©ìê°€ ë³´ë‚´ì¤€ ì½”ë“œë¥¼ í•´ì„í•´ì„œ ìµœì ì˜ sql ë¬¸ì¥ì„ ì¡°ë¦½í•˜ëŠ”ë°,
ì´ ë•Œ ì½”ë“œê°€ ì–¼ë§ˆë‚˜ ì—°ê´€ê´€ê³„ë¥¼ ëª…í™•íˆ ë“œëŸ¬ëƒˆëƒì— ë”°ë¼ ë°œìƒ í•  ìˆ˜ë„ ì•ˆ í•  ìˆ˜ë„ ìˆë‹¤.

Fetch Joinê³¼ @EntityGraphì˜ ê¸°ëŠ¥ì€ 'Cross Joinì„ ë§Œë“¤ì–´ë¼' ë‚˜ 'Inner Joinì„ ë§Œë“¤ì–´ë¼' ê°€ ì•„ë‹ˆê³ ,

'ì—°ê´€ê´€ê³„ ë°ì´í„°ë¥¼ ë¯¸ë¦¬(EAGER) í•¨ê»˜ ê°€ì ¸ì™€ë¼' ì¸ ë§Œí¼ ì¤‘ë³µì„ ì œê±°í•´ì•¼ í•©ë‹ˆë‹¤.

=> ì´ëŸ° ì¤‘ë³µ ë°œìƒ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ DISTINCT ë˜ëŠ” Set ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

1. JPQLì— DISTINCT ë¥¼ ì¶”ê°€í•˜ì—¬ ì¤‘ë³µ ì œê±°
   @Query("select DISTINCT o from Owner o join fetch o.pets")
   List<Owner> findAllJoinFetch();
   @EntityGraph(attributePaths = {"pets"})
   @Query("select DISTINCT o from Owner o")
   List<Owner> findAllEntityGraph();
2. OneToMany í•„ë“œ íƒ€ì…ì„ Setìœ¼ë¡œ ì„ ì–¸í•˜ì—¬ ì¤‘ë³µ ì œê±°
   @OneToMany(mappedBy = "owner", fetch = FetchType.EAGER)
   private Set<Pet> pets = new LinkedHashSet<>();
   (Setì€ ìˆœì„œê°€ ë³´ì¥ë˜ì§€ ì•ŠëŠ” íŠ¹ì§•ì´ ìˆì§€ë§Œ, ìˆœì„œ ë³´ì¥ì´ í•„ìš”í•œ ê²½ìš° LinkedHashSetì„ ì‚¬ìš©í•˜ì.)

